# ğŸŒŸ Octopus Gateway Service

Gatewayæ˜¯Octopus Messengerç³»ç»Ÿçš„æ ¸å¿ƒå…¥å£æœåŠ¡ï¼Œæä¾›ç»Ÿä¸€çš„APIæ¥å£ã€å¾®æœåŠ¡è·¯ç”±å’Œæ™ºèƒ½æ¶ˆæ¯å¤„ç†èƒ½åŠ›ã€‚

## ğŸš€ æ ¸å¿ƒç‰¹æ€§

### ğŸ”¥ æœ€æ–°åŠŸèƒ½ - AIæ™ºèƒ½åˆ†ç±»ç³»ç»Ÿ
- **ğŸ§  åŒæ¨¡å¼AIåˆ†ç±»**ï¼šæ”¯æŒè®­ç»ƒæ¨¡å¼å’Œéšç§æ¨¡å¼
- **âš¡ å®æ—¶æ™ºèƒ½åˆ†ç±»**ï¼šæ¶ˆæ¯æ¥æ”¶æ—¶ç«‹å³è¿›è¡ŒAIåˆ†ç±»
- **ğŸ¯ ç§Ÿæˆ·ä¸“å±æ¨¡å‹**ï¼šæ”¯æŒè®­ç»ƒä¸ªæ€§åŒ–åˆ†ç±»æ¨¡å‹
- **ğŸ”„ æ™ºèƒ½å›é€€æœºåˆ¶**ï¼šAIæœåŠ¡æ•…éšœæ—¶è‡ªåŠ¨é™çº§
- **ğŸ“Š æ‰¹é‡å¤„ç†**ï¼šé«˜æ•ˆçš„æ‰¹é‡æ¶ˆæ¯åˆ†ç±»
- **ğŸš¨ ç´§æ€¥æ¶ˆæ¯æ£€æµ‹**ï¼šè‡ªåŠ¨è¯†åˆ«å’Œä¼˜å…ˆå¤„ç†ç´§æ€¥æ¶ˆæ¯

### ğŸŒ å¤šå¹³å°æ”¯æŒ
- **Telegram Bot**ï¼šå®Œæ•´çš„æ¶ˆæ¯å¤„ç†å’Œäº¤äº’åŠŸèƒ½
- **Discord Bot**ï¼šé¢‘é“æ¶ˆæ¯ã€ç§ä¿¡ã€å‘½ä»¤å¤„ç†
- **WhatsApp Business**ï¼šå•†ä¸šæ¶ˆæ¯ã€æ¨¡æ¿æ¶ˆæ¯ã€åª’ä½“å¤„ç†
- **Slack Bot**ï¼šå·¥ä½œåŒºæ¶ˆæ¯ã€æ–œæ å‘½ä»¤ã€äº¤äº’ç»„ä»¶
- **Line Bot**ï¼šèŠå¤©æ¶ˆæ¯ã€Rich Menuã€Flex Message
- **ä¼ä¸šå¾®ä¿¡**ï¼šä¼ä¸šåº”ç”¨æ¶ˆæ¯ã€é€šè®¯å½•ç®¡ç†

### ğŸ›¡ï¸ ä¼ä¸šçº§åŠŸèƒ½
- **API Gateway**ï¼šç»Ÿä¸€çš„APIå…¥å£å’Œè·¯ç”±
- **èº«ä»½è®¤è¯**ï¼šJWTå’ŒAPI KeyåŒé‡è®¤è¯
- **é¢‘ç‡é™åˆ¶**ï¼šé˜²æ­¢APIæ»¥ç”¨å’Œæ”»å‡»
- **è´Ÿè½½å‡è¡¡**ï¼šå¾®æœåŠ¡ä¹‹é—´çš„æ™ºèƒ½è´Ÿè½½å‡è¡¡
- **ç›‘æ§å‘Šè­¦**ï¼šå®Œæ•´çš„æ€§èƒ½å’Œé”™è¯¯ç›‘æ§
- **æ–‡æ¡£ç³»ç»Ÿ**ï¼šè‡ªåŠ¨ç”Ÿæˆçš„APIæ–‡æ¡£

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          Gateway Service                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Auth        â”‚  â”‚ Rate        â”‚  â”‚ Validation  â”‚  â”‚ Logging â”‚ â”‚
â”‚  â”‚ Middleware  â”‚  â”‚ Limiting    â”‚  â”‚ Middleware  â”‚  â”‚ System  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Webhook     â”‚  â”‚ AI Routes   â”‚  â”‚ Bot         â”‚  â”‚ User    â”‚ â”‚
â”‚  â”‚ Handlers    â”‚  â”‚ & Smart     â”‚  â”‚ Management  â”‚  â”‚ Auth    â”‚ â”‚
â”‚  â”‚             â”‚  â”‚ Classifier  â”‚  â”‚             â”‚  â”‚         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Message     â”‚  â”‚ AI Service  â”‚  â”‚ Microserviceâ”‚  â”‚ Error   â”‚ â”‚
â”‚  â”‚ Processor   â”‚  â”‚ Client      â”‚  â”‚ Proxy       â”‚  â”‚ Handler â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                    â”‚                    â”‚
          â–¼                    â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Bot Platforms  â”‚  â”‚   AI Service    â”‚  â”‚  Microservices  â”‚
â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚
â”‚ â€¢ Telegram      â”‚  â”‚ â€¢ Smart         â”‚  â”‚ â€¢ Message       â”‚
â”‚ â€¢ Discord       â”‚  â”‚   Classifier    â”‚  â”‚   Processor     â”‚
â”‚ â€¢ WhatsApp      â”‚  â”‚ â€¢ Tenant        â”‚  â”‚ â€¢ Task Service  â”‚
â”‚ â€¢ Slack         â”‚  â”‚   Models        â”‚  â”‚ â€¢ Bot Manager   â”‚
â”‚ â€¢ Line          â”‚  â”‚ â€¢ Mode          â”‚  â”‚ â€¢ Admin Panel   â”‚
â”‚ â€¢ WeWork        â”‚  â”‚   Manager       â”‚  â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“¦ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

```bash
Node.js >= 18.0.0
npm >= 8.0.0
PostgreSQL >= 13.0
Redis >= 6.0 (å¯é€‰ï¼Œç”¨äºç¼“å­˜)
```

### å®‰è£…ä¾èµ–

```bash
cd services/gateway
npm install
```

### ç¯å¢ƒé…ç½®

åˆ›å»º `.env` æ–‡ä»¶ï¼š

```bash
# æœåŠ¡é…ç½®
PORT=3000
NODE_ENV=development
HOST=0.0.0.0

# æ•°æ®åº“é…ç½®
DB_HOST=localhost
DB_PORT=5432
DB_NAME=octopus_messenger
DB_USER=octopus_user
DB_PASSWORD=your_password
DB_SSL=false

# JWTé…ç½®
JWT_SECRET=your_jwt_secret_key
JWT_EXPIRES_IN=24h

# AIæœåŠ¡é…ç½®
AI_SERVICE_URL=http://localhost:3002
AI_SERVICE_TIMEOUT=30000
AI_CLASSIFICATION_ENABLED=true
AI_BATCH_PROCESSING_ENABLED=true

# æ¶ˆæ¯å¤„ç†é…ç½®
MESSAGE_RATE_LIMIT_ENABLED=true
MESSAGE_RATE_LIMIT_PER_MINUTE=60
URGENT_MESSAGE_DETECTION=true

# ç¼“å­˜é…ç½®
REDIS_URL=redis://localhost:6379
AI_RESULT_CACHE_ENABLED=true
AI_RESULT_CACHE_TTL=300

# ç›‘æ§é…ç½®
MONITORING_ENABLED=true
LOG_LEVEL=info

# å®‰å…¨é…ç½®
CORS_ORIGINS=http://localhost:3000,http://localhost:3001
RATE_LIMIT_WINDOW_MS=60000
RATE_LIMIT_MAX_REQUESTS=100
```

### å¯åŠ¨æœåŠ¡

```bash
# å¼€å‘ç¯å¢ƒ
npm run dev

# ç”Ÿäº§ç¯å¢ƒ
npm start

# æ„å»ºTypeScript (å¦‚æœéœ€è¦)
npm run build
```

## ğŸ”§ é…ç½®è¯¦è§£

### æœåŠ¡é…ç½®

Gatewayæ”¯æŒå¤šç§é…ç½®æ–¹å¼ï¼š

#### 1. ç¯å¢ƒå˜é‡é…ç½®

```bash
# åŸºç¡€æœåŠ¡è®¾ç½®
export PORT=3000
export NODE_ENV=production
export HOST=0.0.0.0

# å¾®æœåŠ¡ç«¯å£é…ç½®
export AI_SERVICE_PORT=3002
export MESSAGE_PROCESSOR_PORT=3003
export BOT_MANAGER_PORT=3004
export TASK_SERVICE_PORT=3005
```

#### 2. é…ç½®æ–‡ä»¶

```javascript
// config/config.js
module.exports = {
  services: {
    gateway: {
      port: process.env.PORT || 3000,
      host: process.env.HOST || '0.0.0.0'
    },
    aiService: {
      port: process.env.AI_SERVICE_PORT || 3002,
      timeout: process.env.AI_SERVICE_TIMEOUT || 30000
    }
  },
  
  ai: {
    classification: {
      enabled: process.env.AI_CLASSIFICATION_ENABLED === 'true',
      batchProcessing: process.env.AI_BATCH_PROCESSING_ENABLED === 'true'
    }
  }
};
```

#### 3. AIæœåŠ¡é…ç½®

```javascript
// src/config/aiService.js
const aiServiceConfig = {
  baseURL: 'http://localhost:3002',
  timeout: 30000,
  features: {
    smartClassification: true,
    customModels: true,
    batchProcessing: true,
    fallbackMode: true
  }
};
```

## ğŸš€ APIæ¥å£æ–‡æ¡£

### ğŸ” è®¤è¯æ¥å£

#### ç”¨æˆ·ç™»å½•
```bash
POST /api/auth/login
Content-Type: application/json

{
  "email": "user@example.com",
  "password": "your_password"
}

# å“åº”
{
  "success": true,
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "user": {
    "id": "user_123",
    "email": "user@example.com",
    "tenantId": "tenant_001"
  }
}
```

#### ç”¨æˆ·æ³¨å†Œ
```bash
POST /api/auth/register
Content-Type: application/json

{
  "email": "user@example.com",
  "password": "your_password",
  "name": "User Name",
  "tenantId": "tenant_001"
}
```

### ğŸ§  AIæ™ºèƒ½åˆ†ç±»æ¥å£

#### å•æ¶ˆæ¯æ™ºèƒ½åˆ†ç±»
```bash
POST /api/ai/classify
Authorization: Bearer <token>
Content-Type: application/json

{
  "message": {
    "content": "æˆ‘éœ€è¦æŠ€æœ¯æ”¯æŒï¼Œç½‘ç«™æ— æ³•è®¿é—®",
    "platform": "discord",
    "userId": "user123"
  }
}

# å“åº”
{
  "success": true,
  "classification": {
    "category": "technical_support",
    "confidence": 0.89,
    "mode": "training",
    "usedCustomModel": true,
    "classifier": "tenant-rule-engine"
  },
  "processingTime": 156,
  "explanation": {
    "strategy": "ä½¿ç”¨æ‚¨çš„ä¸“å±AIæ¨¡å‹è¿›è¡Œåˆ†ç±»",
    "keywords": ["æŠ€æœ¯æ”¯æŒ", "ç½‘ç«™", "æ— æ³•è®¿é—®"],
    "reasoning": "åŸºäºå†å²æ•°æ®è®­ç»ƒçš„æ¨¡å‹è¯†åˆ«ä¸ºæŠ€æœ¯æ”¯æŒç±»é—®é¢˜"
  }
}
```

#### æ‰¹é‡æ¶ˆæ¯åˆ†ç±»
```bash
POST /api/ai/classify/batch
Authorization: Bearer <token>
Content-Type: application/json

{
  "messages": [
    {
      "content": "è´¦æˆ·ç™»å½•é—®é¢˜",
      "platform": "slack",
      "userId": "user123"
    },
    {
      "content": "äº§å“ä»·æ ¼å’¨è¯¢",
      "platform": "telegram",
      "userId": "user456"
    }
  ]
}

# å“åº”
{
  "success": true,
  "results": [
    {
      "success": true,
      "classification": {
        "category": "account_support",
        "confidence": 0.92
      }
    },
    {
      "success": true,
      "classification": {
        "category": "sales_inquiry",
        "confidence": 0.85
      }
    }
  ],
  "summary": {
    "total": 2,
    "successful": 2,
    "failed": 0,
    "processingTime": 234,
    "averageTimePerMessage": 117
  }
}
```

### ğŸ”„ AIæ¨¡å¼ç®¡ç†æ¥å£

#### è·å–å½“å‰AIæ¨¡å¼
```bash
GET /api/ai/mode
Authorization: Bearer <token>

# å“åº”
{
  "success": true,
  "mode": {
    "currentMode": "training",
    "config": {
      "dataStorage": true,
      "customModels": true,
      "personalizedService": true
    },
    "switchedAt": "2024-01-15T10:30:00Z",
    "switchedBy": "user123"
  }
}
```

#### åˆ‡æ¢AIæ¨¡å¼
```bash
POST /api/ai/mode
Authorization: Bearer <token>
Content-Type: application/json

{
  "mode": "training",
  "reason": "å¸Œæœ›è·å¾—ä¸ªæ€§åŒ–AIæœåŠ¡"
}

# å“åº”
{
  "success": true,
  "message": "AIæ¨¡å¼å·²æˆåŠŸåˆ‡æ¢",
  "previousMode": "normal",
  "currentMode": "training",
  "effectiveAt": "2024-01-15T10:35:00Z"
}
```

#### è·å–æ¨¡å¼æ¨è
```bash
GET /api/ai/mode/recommend
Authorization: Bearer <token>

# å“åº”
{
  "success": true,
  "recommendation": {
    "recommendedMode": "training",
    "reason": "åŸºäºæ‚¨çš„ä½¿ç”¨æƒ…å†µï¼Œè®­ç»ƒæ¨¡å¼å¯ä»¥æä¾›æ›´å¥½çš„åˆ†ç±»å‡†ç¡®æ€§",
    "benefits": [
      "ä¸ªæ€§åŒ–AIåˆ†ç±»",
      "æ›´é«˜çš„å‡†ç¡®ç‡",
      "ä¸“å±æ¨¡å‹è®­ç»ƒ"
    ],
    "considerations": [
      "ä¼šå­˜å‚¨èŠå¤©æ•°æ®ç”¨äºè®­ç»ƒ",
      "éœ€è¦ä»˜è´¹è®¢é˜…"
    ]
  }
}
```

### ğŸ¤– ç§Ÿæˆ·æ¨¡å‹ç®¡ç†æ¥å£

#### è®­ç»ƒä¸“å±æ¨¡å‹
```bash
POST /api/ai/models/train
Authorization: Bearer <token>
Content-Type: application/json

{
  "modelType": "rule-engine",
  "examples": [
    {
      "text": "ç½‘ç«™æ‰“ä¸å¼€äº†",
      "category": "technical_support"
    },
    {
      "text": "æƒ³äº†è§£äº§å“ä»·æ ¼",
      "category": "sales_inquiry"
    },
    {
      "text": "è´¦æˆ·è¢«é”å®š",
      "category": "account_support"
    }
  ]
}

# å“åº”
{
  "success": true,
  "training": {
    "modelId": "model_123",
    "modelType": "rule-engine",
    "status": "training",
    "exampleCount": 3,
    "estimatedTime": "2-3åˆ†é’Ÿ",
    "createdAt": "2024-01-15T10:40:00Z"
  }
}
```

#### æŸ¥çœ‹æ¨¡å‹åˆ—è¡¨
```bash
GET /api/ai/models
Authorization: Bearer <token>

# å“åº”
{
  "success": true,
  "models": [
    {
      "id": "model_123",
      "type": "rule-engine",
      "status": "trained",
      "accuracy": 0.89,
      "exampleCount": 150,
      "trainingTime": "2024-01-15T10:42:00Z",
      "lastUsed": "2024-01-15T11:30:00Z"
    }
  ]
}
```

### ğŸ“Š ç»Ÿè®¡åˆ†ææ¥å£

#### è·å–åˆ†ç±»ç»Ÿè®¡
```bash
GET /api/ai/stats?timeRange=24h
Authorization: Bearer <token>

# å“åº”
{
  "success": true,
  "stats": {
    "totalMessages": 1250,
    "classifiedMessages": 1200,
    "averageConfidence": 0.85,
    "topCategories": [
      {
        "category": "support",
        "count": 450,
        "percentage": 37.5
      },
      {
        "category": "sales",
        "count": 300,
        "percentage": 25.0
      }
    ],
    "modelUsage": {
      "customModel": 800,
      "generalModel": 400
    }
  }
}
```

### ğŸ¤– Botç®¡ç†æ¥å£

#### è·å–Botåˆ—è¡¨
```bash
GET /api/bots
Authorization: Bearer <token>

# å“åº”
{
  "success": true,
  "bots": [
    {
      "id": "bot_123",
      "name": "å®¢æœBot",
      "platform": "telegram",
      "status": "active",
      "createdAt": "2024-01-10T15:00:00Z"
    }
  ]
}
```

#### åˆ›å»ºæ–°Bot
```bash
POST /api/bots
Authorization: Bearer <token>
Content-Type: application/json

{
  "name": "æŠ€æœ¯æ”¯æŒBot",
  "platform": "discord",
  "token": "your_bot_token",
  "webhookUrl": "https://yourdomain.com/webhook/discord"
}
```

## ğŸ”— Webhookæ¥å£

### å¹³å°Webhookç«¯ç‚¹

| å¹³å° | ç«¯ç‚¹ | æ–¹æ³• | è®¤è¯ |
|------|------|------|------|
| Telegram | `/api/webhooks/telegram` | POST | Secret Token |
| Discord | `/api/webhooks/discord` | POST | Public Key |
| WhatsApp | `/api/webhooks/whatsapp` | POST/GET | Signature |
| Slack | `/api/webhooks/slack` | POST | Signature |
| Line | `/api/webhooks/line` | POST | Signature |
| WeWork | `/api/webhooks/wework` | POST | Signature |

### Webhooké…ç½®ç¤ºä¾‹

#### Telegram Bot
```bash
# è®¾ç½®Webhook
curl -X POST https://api.telegram.org/bot<YOUR_TOKEN>/setWebhook \
  -H "Content-Type: application/json" \
  -d '{
    "url": "https://yourdomain.com/api/webhooks/telegram",
    "secret_token": "your_secret_token"
  }'
```

#### Discord Bot
```bash
# åœ¨Discord Developer Portalé…ç½®
# Interactions Endpoint URL: https://yourdomain.com/api/webhooks/discord
```

#### WhatsApp Business
```bash
# åœ¨Meta Developer Consoleé…ç½®
# Webhook URL: https://yourdomain.com/api/webhooks/whatsapp
# Verify Token: your_verify_token
```

## ğŸ›¡ï¸ å®‰å…¨é…ç½®

### è®¤è¯æ–¹å¼

#### 1. JWT Tokenè®¤è¯
```javascript
// åœ¨è¯·æ±‚å¤´ä¸­æ·»åŠ 
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

#### 2. API Keyè®¤è¯
```javascript
// åœ¨è¯·æ±‚å¤´ä¸­æ·»åŠ 
X-API-Key: your_api_key
```

### é¢‘ç‡é™åˆ¶

```javascript
// é»˜è®¤é™åˆ¶é…ç½®
{
  windowMs: 60000,        // 1åˆ†é’Ÿçª—å£
  maxRequests: 100,       // æœ€å¤š100ä¸ªè¯·æ±‚
  skipSuccessfulRequests: false
}
```

### CORSé…ç½®

```javascript
// å…è®¸çš„æº
const corsOrigins = [
  'http://localhost:3000',
  'http://localhost:3001',
  'https://yourdomain.com'
];
```

## ğŸ“Š ç›‘æ§å’Œæ—¥å¿—

### å¥åº·æ£€æŸ¥

```bash
GET /health

# å“åº”
{
  "status": "healthy",
  "timestamp": "2024-01-15T12:00:00Z",
  "uptime": 86400,
  "service": "gateway",
  "dependencies": {
    "database": "connected",
    "redis": "connected",
    "aiService": "connected"
  }
}
```

### æ—¥å¿—æ ¼å¼

```json
{
  "level": "info",
  "message": "AI classification completed",
  "timestamp": "2024-01-15T12:00:00Z",
  "service": "gateway",
  "messageId": "msg_12345",
  "tenantId": "tenant_001",
  "platform": "telegram",
  "classification": {
    "category": "support",
    "confidence": 0.89,
    "processingTime": 156
  }
}
```

### æ€§èƒ½æŒ‡æ ‡

Gatewayæ”¶é›†ä»¥ä¸‹æ€§èƒ½æŒ‡æ ‡ï¼š

- **è¯·æ±‚å“åº”æ—¶é—´**
- **APIè°ƒç”¨æˆåŠŸç‡**
- **AIåˆ†ç±»å‡†ç¡®ç‡**
- **æ¶ˆæ¯å¤„ç†ååé‡**
- **é”™è¯¯ç‡ç»Ÿè®¡**
- **èµ„æºä½¿ç”¨ç‡**

## ğŸš€ éƒ¨ç½²æŒ‡å—

### Dockeréƒ¨ç½²

```dockerfile
# Dockerfile
FROM node:18-alpine

WORKDIR /app

COPY package*.json ./
RUN npm ci --only=production

COPY . .

EXPOSE 3000

CMD ["npm", "start"]
```

```bash
# æ„å»ºå’Œè¿è¡Œ
docker build -t octopus-gateway .
docker run -p 3000:3000 --env-file .env octopus-gateway
```

### Docker Composeéƒ¨ç½²

```yaml
# docker-compose.yml
version: '3.8'

services:
  gateway:
    build: .
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
      - DB_HOST=postgres
      - REDIS_URL=redis://redis:6379
    depends_on:
      - postgres
      - redis
    
  postgres:
    image: postgres:13
    environment:
      - POSTGRES_DB=octopus_messenger
      - POSTGRES_USER=octopus_user
      - POSTGRES_PASSWORD=your_password
    volumes:
      - postgres_data:/var/lib/postgresql/data
    
  redis:
    image: redis:6-alpine
    volumes:
      - redis_data:/data

volumes:
  postgres_data:
  redis_data:
```

### ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

```bash
# 1. å®‰è£…ä¾èµ–
npm ci --only=production

# 2. æ„å»ºé¡¹ç›®
npm run build

# 3. å¯åŠ¨æœåŠ¡
PM2_ENV=production pm2 start ecosystem.config.js

# 4. é…ç½®Nginxåå‘ä»£ç†
server {
    listen 80;
    server_name yourdomain.com;
    
    location / {
        proxy_pass http://localhost:3000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

## ğŸ§ª æµ‹è¯•

### å•å…ƒæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
npm test

# ç›‘å¬æ¨¡å¼
npm run test:watch

# è¦†ç›–ç‡æŠ¥å‘Š
npm run test:coverage
```

### APIæµ‹è¯•

```bash
# å¥åº·æ£€æŸ¥
curl http://localhost:3000/health

# ç”¨æˆ·è®¤è¯
curl -X POST http://localhost:3000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"test@example.com","password":"password"}'

# AIåˆ†ç±»æµ‹è¯•
curl -X POST http://localhost:3000/api/ai/classify \
  -H "Authorization: Bearer <token>" \
  -H "Content-Type: application/json" \
  -d '{"message":{"content":"æµ‹è¯•æ¶ˆæ¯","platform":"test"}}'
```

## ğŸ“š APIæ–‡æ¡£

### Swaggeræ–‡æ¡£

å¯åŠ¨æœåŠ¡åï¼Œè®¿é—®ä»¥ä¸‹åœ°å€æŸ¥çœ‹å®Œæ•´APIæ–‡æ¡£ï¼š

```
http://localhost:3000/api/docs
```

### APIé›†åˆ

æˆ‘ä»¬æä¾›äº†Postmanå’ŒInsomniaçš„APIé›†åˆæ–‡ä»¶ï¼š

- `docs/postman-collection.json`
- `docs/insomnia-collection.json`

## ğŸš¨ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. æœåŠ¡å¯åŠ¨å¤±è´¥
```bash
# æ£€æŸ¥ç«¯å£å ç”¨
lsof -i :3000

# æ£€æŸ¥ç¯å¢ƒå˜é‡
printenv | grep -E "(PORT|NODE_ENV|DB_)"

# æŸ¥çœ‹æ—¥å¿—
tail -f logs/gateway.log
```

#### 2. æ•°æ®åº“è¿æ¥å¤±è´¥
```bash
# æµ‹è¯•æ•°æ®åº“è¿æ¥
psql -h localhost -p 5432 -U octopus_user -d octopus_messenger

# æ£€æŸ¥æ•°æ®åº“é…ç½®
node -e "console.log(require('./config/config').database)"
```

#### 3. AIæœåŠ¡è¿æ¥å¤±è´¥
```bash
# æ£€æŸ¥AIæœåŠ¡çŠ¶æ€
curl http://localhost:3002/health

# æ£€æŸ¥ç½‘ç»œè¿æ¥
telnet localhost 3002

# éªŒè¯AIæœåŠ¡é…ç½®
node -e "console.log(require('./src/config/aiService').aiServiceConfig)"
```

#### 4. æ€§èƒ½é—®é¢˜
```bash
# æŸ¥çœ‹èµ„æºä½¿ç”¨
htop
iostat -x 1
df -h

# æ£€æŸ¥æ—¥å¿—é”™è¯¯
grep -i error logs/gateway.log
```

### è°ƒè¯•æŠ€å·§

#### 1. å¯ç”¨è¯¦ç»†æ—¥å¿—
```bash
export LOG_LEVEL=debug
export DEBUG=*
npm run dev
```

#### 2. ä½¿ç”¨è°ƒè¯•å·¥å…·
```bash
# Node.jsè°ƒè¯•
node --inspect src/index.js

# ä½¿ç”¨nodemonè°ƒè¯•
nodemon --inspect src/index.js
```

#### 3. æ€§èƒ½åˆ†æ
```bash
# ä½¿ç”¨clinic.js
npx clinic doctor -- node src/index.js

# å†…å­˜åˆ†æ
node --inspect --max-old-space-size=4096 src/index.js
```

## ğŸ”§ å¼€å‘æŒ‡å—

### é¡¹ç›®ç»“æ„

```
services/gateway/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ config/           # é…ç½®æ–‡ä»¶
â”‚   â”‚   â””â”€â”€ aiService.js  # AIæœåŠ¡é…ç½®
â”‚   â”œâ”€â”€ controllers/      # æ§åˆ¶å™¨
â”‚   â”œâ”€â”€ middleware/       # ä¸­é—´ä»¶
â”‚   â”‚   â”œâ”€â”€ auth.js       # è®¤è¯ä¸­é—´ä»¶
â”‚   â”‚   â”œâ”€â”€ errorHandler.js # é”™è¯¯å¤„ç†
â”‚   â”‚   â””â”€â”€ messageProcessor.js # æ¶ˆæ¯å¤„ç†
â”‚   â”œâ”€â”€ routes/           # è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ auth.js       # è®¤è¯è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ ai.js         # AIè·¯ç”±
â”‚   â”‚   â”œâ”€â”€ bots.js       # Botç®¡ç†
â”‚   â”‚   â”œâ”€â”€ messages.js   # æ¶ˆæ¯ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ tasks.js      # ä»»åŠ¡ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ users.js      # ç”¨æˆ·ç®¡ç†
â”‚   â”‚   â””â”€â”€ webhooks.js   # Webhookå¤„ç†
â”‚   â”œâ”€â”€ utils/            # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ logger.js     # æ—¥å¿—å·¥å…·
â”‚   â”‚   â””â”€â”€ AIServiceClient.js # AIæœåŠ¡å®¢æˆ·ç«¯
â”‚   â””â”€â”€ index.js          # å…¥å£æ–‡ä»¶
â”œâ”€â”€ tests/                # æµ‹è¯•æ–‡ä»¶
â”œâ”€â”€ docs/                 # æ–‡æ¡£
â”œâ”€â”€ logs/                 # æ—¥å¿—ç›®å½•
â”œâ”€â”€ package.json          # é¡¹ç›®é…ç½®
â””â”€â”€ README.md             # è¯´æ˜æ–‡æ¡£
```

### ä»£ç è§„èŒƒ

#### 1. ESLinté…ç½®
```javascript
// .eslintrc.js
module.exports = {
  env: {
    node: true,
    es2021: true,
  },
  extends: [
    'eslint:recommended',
  ],
  parserOptions: {
    ecmaVersion: 12,
    sourceType: 'module',
  },
  rules: {
    'no-console': 'warn',
    'no-unused-vars': 'error',
    'prefer-const': 'error',
  },
};
```

#### 2. Prettieré…ç½®
```javascript
// .prettierrc
{
  "semi": true,
  "trailingComma": "es5",
  "singleQuote": true,
  "printWidth": 80,
  "tabWidth": 2
}
```

### è´¡çŒ®æŒ‡å—

1. **Forké¡¹ç›®**
2. **åˆ›å»ºç‰¹æ€§åˆ†æ”¯**ï¼š`git checkout -b feature/new-feature`
3. **æäº¤æ›´æ”¹**ï¼š`git commit -am 'Add new feature'`
4. **æ¨é€åˆ†æ”¯**ï¼š`git push origin feature/new-feature`
5. **æäº¤PR**ï¼šåˆ›å»ºPull Request

### ç‰ˆæœ¬å‘å¸ƒ

```bash
# æ›´æ–°ç‰ˆæœ¬å·
npm version patch  # 1.0.0 -> 1.0.1
npm version minor  # 1.0.1 -> 1.1.0
npm version major  # 1.1.0 -> 2.0.0

# å‘å¸ƒåˆ°npm
npm publish
```

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### ç¤¾åŒºæ”¯æŒ

- **GitHub Issues**: [æäº¤é—®é¢˜](https://github.com/octopus-messenger/gateway/issues)
- **è®¨è®ºåŒº**: [æŠ€æœ¯è®¨è®º](https://github.com/octopus-messenger/gateway/discussions)
- **Wiki**: [è¯¦ç»†æ–‡æ¡£](https://github.com/octopus-messenger/gateway/wiki)

### è”ç³»æˆ‘ä»¬

- **é‚®ç®±**: support@octopus-messenger.com
- **æŠ€æœ¯æ”¯æŒ**: tech@octopus-messenger.com
- **å•†åŠ¡åˆä½œ**: business@octopus-messenger.com

### èµ„æºé“¾æ¥

- **å®˜æ–¹ç½‘ç«™**: https://octopus-messenger.com
- **æ–‡æ¡£ä¸­å¿ƒ**: https://docs.octopus-messenger.com
- **çŠ¶æ€é¡µé¢**: https://status.octopus-messenger.com

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®ä½¿ç”¨ MIT è®¸å¯è¯ã€‚è¯¦æƒ…è¯·å‚é˜… [LICENSE](LICENSE) æ–‡ä»¶ã€‚

---

<div align="center">
  <p><strong>ğŸ™ Octopus Messenger Gateway</strong></p>
  <p>ç»Ÿä¸€çš„å¤šå¹³å°æ¶ˆæ¯å¤„ç†ç½‘å…³ï¼Œæ”¯æŒAIæ™ºèƒ½åˆ†ç±»å’ŒåŒæ¨¡å¼æœåŠ¡</p>
  <p>
    <a href="https://github.com/octopus-messenger/gateway">GitHub</a> â€¢
    <a href="https://docs.octopus-messenger.com">æ–‡æ¡£</a> â€¢
    <a href="https://octopus-messenger.com">å®˜ç½‘</a>
  </p>
</div> 