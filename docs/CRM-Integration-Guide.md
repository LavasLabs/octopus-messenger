# CRM ç³»ç»Ÿé›†æˆæŒ‡å—

## æ¦‚è¿°

Octopus Messenger æ”¯æŒä¸å¤šç§ä¸»æµCRMå’Œä»»åŠ¡ç®¡ç†ç³»ç»Ÿé›†æˆï¼Œè‡ªåŠ¨å°†åˆ†ç±»åçš„å®¢æˆ·æ¶ˆæ¯è½¬æ¢ä¸ºä»»åŠ¡ã€å·¥å•æˆ–æ½œåœ¨å®¢æˆ·çº¿ç´¢ã€‚

## æ”¯æŒçš„CRMç³»ç»Ÿ

### ğŸ¢ ä¼ä¸šçº§CRM

#### 1. Salesforce
- **ç±»å‹**: å…¨çƒæœ€å¤§çš„CRMå¹³å°
- **é€‚ç”¨**: å¤§å‹ä¼ä¸šã€å¤æ‚é”€å”®æµç¨‹
- **é›†æˆæ–¹å¼**: REST API + OAuth 2.0

#### 2. Microsoft Dynamics 365
- **ç±»å‹**: å¾®è½¯ä¼ä¸šè§£å†³æ–¹æ¡ˆ
- **é€‚ç”¨**: ä½¿ç”¨Microsoftç”Ÿæ€çš„ä¼ä¸š
- **é›†æˆæ–¹å¼**: Web API + Azure AD

#### 3. HubSpot
- **ç±»å‹**: å…¥ç«™è¥é”€CRM
- **é€‚ç”¨**: ä¸­å°ä¼ä¸šã€è¥é”€å¯¼å‘
- **é›†æˆæ–¹å¼**: REST API + API Key

### ğŸ“± ä¸­å›½æœ¬åœŸCRM

#### 4. é’‰é’‰ï¼ˆDingTalkï¼‰
- **ç±»å‹**: é˜¿é‡Œå·´å·´ä¼ä¸šåä½œå¹³å°
- **é€‚ç”¨**: ä¸­å›½ä¼ä¸šã€ç§»åŠ¨åŠå…¬
- **é›†æˆæ–¹å¼**: å¼€æ”¾å¹³å°API

#### 5. ä¼ä¸šå¾®ä¿¡
- **ç±»å‹**: è…¾è®¯ä¼ä¸šé€šè®¯è§£å†³æ–¹æ¡ˆ
- **é€‚ç”¨**: å¾®ä¿¡ç”Ÿæ€ä¼ä¸š
- **é›†æˆæ–¹å¼**: ä¼ä¸šå¾®ä¿¡API

#### 6. é£ä¹¦ï¼ˆLarkï¼‰
- **ç±»å‹**: å­—èŠ‚è·³åŠ¨åä½œå¹³å°
- **é€‚ç”¨**: ç°ä»£åŒ–å›¢é˜Ÿåä½œ
- **é›†æˆæ–¹å¼**: å¼€æ”¾å¹³å°API

### ğŸš€ ç°ä»£åŒ–å·¥å…·

#### 7. Notion
- **ç±»å‹**: å…¨èƒ½å·¥ä½œç©ºé—´
- **é€‚ç”¨**: çµæ´»çš„å›¢é˜Ÿç®¡ç†
- **é›†æˆæ–¹å¼**: Notion API

#### 8. Airtable
- **ç±»å‹**: å¯è§†åŒ–æ•°æ®åº“
- **é€‚ç”¨**: æ•°æ®é©±åŠ¨çš„å›¢é˜Ÿ
- **é›†æˆæ–¹å¼**: REST API

#### 9. Monday.com
- **ç±»å‹**: å·¥ä½œæ“ä½œç³»ç»Ÿ
- **é€‚ç”¨**: é¡¹ç›®å’Œå®¢æˆ·ç®¡ç†
- **é›†æˆæ–¹å¼**: GraphQL API

### ğŸ“‹ é¡¹ç›®ç®¡ç†å·¥å…·

#### 10. Jira
- **ç±»å‹**: Atlassiané¡¹ç›®ç®¡ç†
- **é€‚ç”¨**: æŠ€æœ¯å›¢é˜Ÿã€æ•æ·å¼€å‘
- **é›†æˆæ–¹å¼**: REST API

#### 11. Asana
- **ç±»å‹**: å›¢é˜Ÿåä½œå¹³å°
- **é€‚ç”¨**: ä»»åŠ¡å¯¼å‘çš„å›¢é˜Ÿ
- **é›†æˆæ–¹å¼**: REST API

#### 12. ClickUp
- **ç±»å‹**: å…¨åŠŸèƒ½ç”Ÿäº§åŠ›å¹³å°
- **é€‚ç”¨**: éœ€è¦ç»Ÿä¸€å·¥ä½œç©ºé—´çš„å›¢é˜Ÿ
- **é›†æˆæ–¹å¼**: REST API v2

#### 13. Linear
- **ç±»å‹**: ç°ä»£åŒ–é—®é¢˜è·Ÿè¸ª
- **é€‚ç”¨**: äº§å“å’Œå·¥ç¨‹å›¢é˜Ÿ
- **é›†æˆæ–¹å¼**: GraphQL API

#### 14. Trello
- **ç±»å‹**: çœ‹æ¿å¼é¡¹ç›®ç®¡ç†
- **é€‚ç”¨**: ç®€å•çš„ä»»åŠ¡ç®¡ç†
- **é›†æˆæ–¹å¼**: REST API

### ğŸ’¼ å…¶ä»–ä¸“ä¸šå·¥å…·

#### 15. Zoho CRM
- **ç±»å‹**: ä¸€ä½“åŒ–ä¸šåŠ¡å¥—ä»¶
- **é€‚ç”¨**: ä¸­å°ä¼ä¸š
- **é›†æˆæ–¹å¼**: REST API v2

#### 16. Pipedrive
- **ç±»å‹**: é”€å”®ç®¡é“CRM
- **é€‚ç”¨**: é”€å”®å›¢é˜Ÿ
- **é›†æˆæ–¹å¼**: REST API

---

## é›†æˆé…ç½®

### é€šç”¨é…ç½®ç»“æ„

```json
{
  "crmIntegrations": [
    {
      "id": "primary-crm",
      "name": "ä¸»è¦CRMç³»ç»Ÿ",
      "type": "salesforce",
      "enabled": true,
      "priority": 1,
      "config": {
        "authType": "oauth2",
        "credentials": {},
        "endpoints": {},
        "mappings": {}
      },
      "rules": {
        "conditions": [],
        "actions": []
      }
    }
  ]
}
```

### Salesforce é›†æˆ

#### é…ç½®ç¤ºä¾‹
```json
{
  "type": "salesforce",
  "config": {
    "authType": "oauth2",
    "credentials": {
      "clientId": "your-connected-app-client-id",
      "clientSecret": "your-client-secret",
      "username": "your-salesforce-username",
      "password": "your-password-and-security-token",
      "sandbox": false
    },
    "endpoints": {
      "baseUrl": "https://your-instance.salesforce.com",
      "apiVersion": "v58.0"
    },
    "mappings": {
      "lead": {
        "firstName": "{{senderName}}",
        "lastName": "å®¢æˆ·",
        "email": "{{senderEmail}}",
        "phone": "{{senderPhone}}",
        "company": "{{tenantName}}",
        "leadSource": "{{platform}}",
        "description": "{{messageContent}}"
      },
      "case": {
        "subject": "å®¢æˆ·å’¨è¯¢ - {{category}}",
        "description": "{{messageContent}}",
        "priority": "{{priority}}",
        "origin": "{{platform}}",
        "status": "New"
      }
    }
  }
}
```

#### é›†æˆä»£ç 
```javascript
// services/task-service/src/integrations/salesforce.js
class SalesforceIntegration {
  constructor(config) {
    this.config = config;
    this.accessToken = null;
  }

  async authenticate() {
    const authUrl = `${this.config.endpoints.baseUrl}/services/oauth2/token`;
    const response = await axios.post(authUrl, {
      grant_type: 'password',
      client_id: this.config.credentials.clientId,
      client_secret: this.config.credentials.clientSecret,
      username: this.config.credentials.username,
      password: this.config.credentials.password
    });
    
    this.accessToken = response.data.access_token;
    return this.accessToken;
  }

  async createLead(messageData, classification) {
    const leadData = this.mapToLead(messageData, classification);
    
    const response = await axios.post(
      `${this.config.endpoints.baseUrl}/services/data/v${this.config.endpoints.apiVersion}/sobjects/Lead/`,
      leadData,
      {
        headers: {
          'Authorization': `Bearer ${this.accessToken}`,
          'Content-Type': 'application/json'
        }
      }
    );
    
    return response.data;
  }

  async createCase(messageData, classification) {
    const caseData = this.mapToCase(messageData, classification);
    
    const response = await axios.post(
      `${this.config.endpoints.baseUrl}/services/data/v${this.config.endpoints.apiVersion}/sobjects/Case/`,
      caseData,
      {
        headers: {
          'Authorization': `Bearer ${this.accessToken}`,
          'Content-Type': 'application/json'
        }
      }
    );
    
    return response.data;
  }
}
```

### HubSpot é›†æˆ

#### é…ç½®ç¤ºä¾‹
```json
{
  "type": "hubspot",
  "config": {
    "authType": "apikey",
    "credentials": {
      "apiKey": "your-hubspot-api-key"
    },
    "endpoints": {
      "baseUrl": "https://api.hubapi.com"
    },
    "mappings": {
      "contact": {
        "firstname": "{{senderFirstName}}",
        "lastname": "{{senderLastName}}",
        "email": "{{senderEmail}}",
        "phone": "{{senderPhone}}",
        "lifecyclestage": "lead",
        "lead_source": "{{platform}}"
      },
      "ticket": {
        "subject": "{{category}} - {{messageContent|truncate:50}}",
        "content": "{{messageContent}}",
        "hs_pipeline": "support_pipeline",
        "hs_pipeline_stage": "new",
        "hs_ticket_priority": "{{priority}}"
      }
    }
  }
}
```

### é’‰é’‰é›†æˆ

#### é…ç½®ç¤ºä¾‹
```json
{
  "type": "dingtalk",
  "config": {
    "authType": "app_secret",
    "credentials": {
      "appKey": "your-app-key",
      "appSecret": "your-app-secret"
    },
    "endpoints": {
      "baseUrl": "https://oapi.dingtalk.com"
    },
    "mappings": {
      "task": {
        "subject": "å®¢æˆ·å’¨è¯¢ - {{category}}",
        "description": "{{messageContent}}",
        "priority": "{{priority}}",
        "executorIds": ["{{assigneeUserId}}"],
        "participantIds": [],
        "ccIds": []
      }
    }
  }
}
```

### ä¼ä¸šå¾®ä¿¡é›†æˆ

#### é…ç½®ç¤ºä¾‹
```json
{
  "type": "wework",
  "config": {
    "authType": "corp_secret",
    "credentials": {
      "corpId": "your-corp-id",
      "agentId": "your-agent-id",
      "secret": "your-agent-secret"
    },
    "endpoints": {
      "baseUrl": "https://qyapi.weixin.qq.com"
    },
    "mappings": {
      "oa_approval": {
        "template_id": "customer_inquiry_template",
        "applicant": "{{systemUserId}}",
        "approver": ["{{managerUserId}}"],
        "data": {
          "customer_name": "{{senderName}}",
          "platform": "{{platform}}",
          "content": "{{messageContent}}",
          "category": "{{category}}",
          "priority": "{{priority}}"
        }
      }
    }
  }
}
```

### Notion é›†æˆ

#### é…ç½®ç¤ºä¾‹
```json
{
  "type": "notion",
  "config": {
    "authType": "integration_token",
    "credentials": {
      "token": "your-notion-integration-token"
    },
    "endpoints": {
      "baseUrl": "https://api.notion.com/v1"
    },
    "databaseId": "your-database-id",
    "mappings": {
      "page": {
        "properties": {
          "å®¢æˆ·å§“å": {
            "title": [{"text": {"content": "{{senderName}}"}}]
          },
          "å¹³å°": {
            "select": {"name": "{{platform}}"}
          },
          "åˆ†ç±»": {
            "select": {"name": "{{category}}"}
          },
          "ä¼˜å…ˆçº§": {
            "select": {"name": "{{priority}}"}
          },
          "çŠ¶æ€": {
            "select": {"name": "å¾…å¤„ç†"}
          },
          "å†…å®¹": {
            "rich_text": [{"text": {"content": "{{messageContent}}"}}]
          },
          "åˆ›å»ºæ—¶é—´": {
            "date": {"start": "{{receivedAt}}"}
          }
        }
      }
    }
  }
}
```

### Monday.com é›†æˆ

#### é…ç½®ç¤ºä¾‹
```json
{
  "type": "monday",
  "config": {
    "authType": "api_token",
    "credentials": {
      "token": "your-monday-api-token"
    },
    "endpoints": {
      "baseUrl": "https://api.monday.com/v2"
    },
    "boardId": "your-board-id",
    "mappings": {
      "item": {
        "name": "{{category}} - {{senderName}}",
        "columnValues": {
          "status": "å¾…å¤„ç†",
          "priority": "{{priority}}",
          "platform": "{{platform}}",
          "customer_name": "{{senderName}}",
          "content": "{{messageContent}}",
          "received_date": "{{receivedAt}}"
        }
      }
    }
  }
}
```

---

## å¤šCRMç­–ç•¥

### 1. ä¸»å¤‡æ¨¡å¼
```json
{
  "strategy": "primary_backup",
  "primary": {
    "type": "salesforce",
    "fallback": "hubspot"
  },
  "rules": {
    "if_primary_fails": "use_backup",
    "sync_back": true
  }
}
```

### 2. åˆ†ç±»è·¯ç”±
```json
{
  "strategy": "category_routing",
  "routes": {
    "é”€å”®çº¿ç´¢": ["salesforce", "hubspot"],
    "æŠ€æœ¯æ”¯æŒ": ["jira", "linear"],
    "å®¢æˆ·æœåŠ¡": ["zendesk", "freshdesk"],
    "äº§å“åé¦ˆ": ["notion", "airtable"]
  }
}
```

### 3. å¹¶è¡ŒåŒæ­¥
```json
{
  "strategy": "parallel_sync",
  "targets": [
    {
      "type": "salesforce",
      "objects": ["lead", "case"]
    },
    {
      "type": "slack",
      "channels": ["#customer-support"]
    },
    {
      "type": "email",
      "recipients": ["support@company.com"]
    }
  ]
}
```

---

## é›†æˆç®¡ç†

### é…ç½®ç•Œé¢

#### 1. CRMç³»ç»Ÿé€‰æ‹©
```javascript
// ç®¡ç†é¢æ¿ä¸­çš„CRMé€‰æ‹©ç»„ä»¶
const CRMSelector = () => {
  const [selectedCRM, setSelectedCRM] = useState('lark');
  
  const crmOptions = [
    { id: 'salesforce', name: 'Salesforce', icon: 'salesforce' },
    { id: 'hubspot', name: 'HubSpot', icon: 'hubspot' },
    { id: 'dingtalk', name: 'é’‰é’‰', icon: 'dingtalk' },
    { id: 'wework', name: 'ä¼ä¸šå¾®ä¿¡', icon: 'wework' },
    { id: 'notion', name: 'Notion', icon: 'notion' },
    { id: 'monday', name: 'Monday.com', icon: 'monday' },
    { id: 'jira', name: 'Jira', icon: 'jira' },
    { id: 'asana', name: 'Asana', icon: 'asana' }
  ];
  
  return (
    <div className="crm-selector">
      <h3>é€‰æ‹©CRMç³»ç»Ÿ</h3>
      <div className="crm-grid">
        {crmOptions.map(crm => (
          <div 
            key={crm.id} 
            className={`crm-card ${selectedCRM === crm.id ? 'selected' : ''}`}
            onClick={() => setSelectedCRM(crm.id)}
          >
            <img src={`/icons/${crm.icon}.svg`} alt={crm.name} />
            <span>{crm.name}</span>
          </div>
        ))}
      </div>
    </div>
  );
};
```

#### 2. è¿æ¥æµ‹è¯•
```javascript
const testCRMConnection = async (crmConfig) => {
  try {
    const response = await fetch('/api/crm/test-connection', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${authToken}`
      },
      body: JSON.stringify(crmConfig)
    });
    
    const result = await response.json();
    return result;
  } catch (error) {
    console.error('CRMè¿æ¥æµ‹è¯•å¤±è´¥:', error);
    return { success: false, error: error.message };
  }
};
```

### APIç«¯ç‚¹

#### è·å–æ”¯æŒçš„CRMåˆ—è¡¨
```bash
GET /api/crm/supported
```

#### é…ç½®CRMé›†æˆ
```bash
POST /api/crm/configure
{
  "type": "salesforce",
  "config": {...},
  "enabled": true
}
```

#### æµ‹è¯•CRMè¿æ¥
```bash
POST /api/crm/test-connection
{
  "type": "salesforce",
  "config": {...}
}
```

#### åŒæ­¥çŠ¶æ€æŸ¥è¯¢
```bash
GET /api/crm/sync-status/{integration-id}
```

---

## æœ€ä½³å®è·µ

### 1. é€‰æ‹©å»ºè®®

#### å¤§å‹ä¼ä¸š
- **é¦–é€‰**: Salesforce + Microsoft Dynamics 365
- **å¤‡é€‰**: HubSpot Enterprise

#### ä¸­å°ä¼ä¸š
- **é¦–é€‰**: HubSpot + Monday.com
- **å¤‡é€‰**: Zoho CRM + Asana

#### ä¸­å›½ä¼ä¸š
- **é¦–é€‰**: é’‰é’‰ + ä¼ä¸šå¾®ä¿¡
- **å¤‡é€‰**: é£ä¹¦ + è…¾è®¯æ–‡æ¡£

#### æŠ€æœ¯å›¢é˜Ÿ
- **é¦–é€‰**: Jira + Linear
- **å¤‡é€‰**: GitHub Issues + ClickUp

#### åˆ›ä¸šå…¬å¸
- **é¦–é€‰**: Notion + Airtable
- **å¤‡é€‰**: Trello + Monday.com

### 2. é›†æˆç­–ç•¥

#### æ¸è¿›å¼é›†æˆ
1. ä»ä¸€ä¸ªä¸»è¦CRMå¼€å§‹
2. éªŒè¯æ•°æ®åŒæ­¥å‡†ç¡®æ€§
3. é€æ­¥æ·»åŠ å…¶ä»–ç³»ç»Ÿ
4. ä¼˜åŒ–é›†æˆè§„åˆ™

#### æ•°æ®ä¸€è‡´æ€§
1. å»ºç«‹ç»Ÿä¸€çš„æ•°æ®æ¨¡å‹
2. è®¾ç½®æ•°æ®éªŒè¯è§„åˆ™
3. å®šæœŸåŒæ­¥æ£€æŸ¥
4. å¤„ç†å†²çªæ•°æ®

#### æ€§èƒ½ä¼˜åŒ–
1. ä½¿ç”¨å¼‚æ­¥å¤„ç†
2. æ‰¹é‡æ“ä½œä¼˜åŒ–
3. ç¼“å­˜å¸¸ç”¨æ•°æ®
4. ç›‘æ§APIé™åˆ¶

### 3. æ•…éšœå¤„ç†

#### é‡è¯•æœºåˆ¶
```javascript
const retryIntegration = async (operation, maxRetries = 3) => {
  for (let i = 0; i < maxRetries; i++) {
    try {
      return await operation();
    } catch (error) {
      if (i === maxRetries - 1) throw error;
      await new Promise(resolve => setTimeout(resolve, 1000 * Math.pow(2, i)));
    }
  }
};
```

#### é™çº§ç­–ç•¥
```javascript
const fallbackIntegration = async (primaryCRM, fallbackCRM, data) => {
  try {
    return await primaryCRM.createTask(data);
  } catch (error) {
    logger.warn('Primary CRM failed, using fallback', { error });
    return await fallbackCRM.createTask(data);
  }
};
```

è¿™æ ·çš„å¤šCRMé›†æˆæ–¹æ¡ˆè®©ä¼ä¸šå®¢æˆ·å¯ä»¥ç»§ç»­ä½¿ç”¨ç°æœ‰çš„ç³»ç»Ÿï¼ŒåŒæ—¶äº«å—Octopus Messengerçš„æ™ºèƒ½æ¶ˆæ¯å¤„ç†èƒ½åŠ›ï¼ 